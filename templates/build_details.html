{% extends "base.html" %}

{% block title %}{{ build.name }} - Wheel Builder{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 2rem 0; margin-bottom: 2rem;">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h1 class="mb-0"><i class="bi bi-gear-fill"></i> {{ build.name }}</h1>
                <p class="mb-0 mt-2 opacity-75">Build Details and Specifications</p>
            </div>
            <div class="mt-2 mt-md-0">
                <span class="badge bg-{% if build.status == 'completed' %}success{% elif build.status == 'in_progress' %}warning text-dark{% else %}secondary{% endif %} fs-5">
                    {{ build.status|replace('_', ' ')|title }}
                </span>
            </div>
        </div>
    </div>
</div>

<div class="container pb-5">
    <!-- Build Information Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
            <h5 class="mb-0"><i class="bi bi-info-circle"></i> Build Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted">Name</label>
                        <p class="mb-0">{{ build.name }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted">Status</label>
                        <form method="POST" action="/build/{{ build.id }}/status" class="d-inline">
                            <select name="status" class="form-select form-select-sm d-inline-block w-auto" onchange="this.form.submit()">
                                <option value="draft" {% if build.status == 'draft' %}selected{% endif %}>Draft</option>
                                <option value="in_progress" {% if build.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                                <option value="completed" {% if build.status == 'completed' %}selected{% endif %}>Completed</option>
                            </select>
                        </form>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted">Created</label>
                        <p class="mb-0">{{ build.created_at.strftime('%B %d, %Y at %I:%M %p') if build.created_at else 'N/A' }}</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted">Last Updated</label>
                        <p class="mb-0">{{ build.updated_at.strftime('%B %d, %Y at %I:%M %p') if build.updated_at else 'N/A' }}</p>
                    </div>
                </div>
            </div>
            {% if build.comments %}
            <div class="mt-3">
                <label class="form-label fw-bold text-muted">Comments</label>
                <p class="mb-0 text-wrap" style="white-space: pre-wrap;">{{ build.comments }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Component Specifications Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
            <h5 class="mb-0"><i class="bi bi-list-check"></i> Component Specifications</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3 bg-light">
                        <h6 class="text-primary mb-3"><i class="bi bi-bullseye"></i> Hub</h6>
                        {% if hub %}
                        <div class="mb-2">
                            <span class="text-muted">Make/Model:</span>
                            <span class="float-end fw-bold">{{ hub.make }} {{ hub.model }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Type:</span>
                            <span class="float-end fw-bold">{{ hub.type|title }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">OLD:</span>
                            <span class="float-end fw-bold">{{ hub.old }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Left Flange Ø:</span>
                            <span class="float-end fw-bold">{{ hub.left_flange_diameter }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Right Flange Ø:</span>
                            <span class="float-end fw-bold">{{ hub.right_flange_diameter }}mm</span>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0"><i class="bi bi-exclamation-triangle"></i> Not selected</p>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3 bg-light">
                        <h6 class="text-primary mb-3"><i class="bi bi-circle"></i> Rim</h6>
                        {% if rim %}
                        <div class="mb-2">
                            <span class="text-muted">Make/Model:</span>
                            <span class="float-end fw-bold">{{ rim.make }} {{ rim.model }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Type:</span>
                            <span class="float-end fw-bold">{{ rim.type|title }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Holes:</span>
                            <span class="float-end fw-bold">{{ rim.holes }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">ERD:</span>
                            <span class="float-end fw-bold">{{ rim.erd }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Material:</span>
                            <span class="float-end fw-bold">{{ rim.material|title }}</span>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0"><i class="bi bi-exclamation-triangle"></i> Not selected</p>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3 bg-light">
                        <h6 class="text-primary mb-3"><i class="bi bi-slash-lg"></i> Spoke</h6>
                        {% if spoke %}
                        <div class="mb-2">
                            <span class="text-muted">Material:</span>
                            <span class="float-end fw-bold">{{ spoke.material|title }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Gauge:</span>
                            <span class="float-end fw-bold">{{ spoke.gauge }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Length:</span>
                            <span class="float-end fw-bold">{{ spoke.length }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Max Tension:</span>
                            <span class="float-end fw-bold">{{ spoke.max_tension }} kgf</span>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0"><i class="bi bi-exclamation-triangle"></i> Not selected</p>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3 bg-light">
                        <h6 class="text-primary mb-3"><i class="bi bi-nut"></i> Nipple</h6>
                        {% if nipple %}
                        <div class="mb-2">
                            <span class="text-muted">Material:</span>
                            <span class="float-end fw-bold">{{ nipple.material|title }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Diameter:</span>
                            <span class="float-end fw-bold">{{ nipple.diameter }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Length:</span>
                            <span class="float-end fw-bold">{{ nipple.length }}mm</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Color:</span>
                            <span class="float-end fw-bold">{{ nipple.color|title }}</span>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0"><i class="bi bi-exclamation-triangle"></i> Not selected</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="border rounded p-3 bg-light">
                        <h6 class="text-primary mb-3"><i class="bi bi-asterisk"></i> Lacing Configuration</h6>
                        <div class="mb-2">
                            <span class="text-muted">Pattern:</span>
                            <span class="float-end fw-bold">{{ build.lacing_pattern|replace('-', ' ')|title if build.lacing_pattern else 'Not set' }}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted">Spoke Count:</span>
                            <span class="float-end fw-bold">{{ build.spoke_count if build.spoke_count else 'Not set' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spoke Length Recommendations Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
            <h5 class="mb-0"><i class="bi bi-calculator"></i> Spoke Length Recommendations</h5>
        </div>
        <div class="card-body">
            {% if can_calculate %}
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3" style="border-left: 4px solid var(--secondary-color) !important;">
                        <h6 class="text-secondary mb-3"><i class="bi bi-arrow-left"></i> Left Side</h6>
                        <div class="mb-2">
                            <span class="text-muted">Calculated Length:</span>
                            <span class="float-end fw-bold fs-5 text-primary">{{ calculated_left }}mm</span>
                        </div>
                        {% if build.actual_spoke_length_left %}
                        <div class="mb-2">
                            <span class="text-muted">Actual Length Used:</span>
                            <span class="float-end fw-bold text-success">{{ build.actual_spoke_length_left }}mm</span>
                        </div>
                        {% else %}
                        <div class="alert alert-info alert-sm mb-0 mt-2">
                            <small><i class="bi bi-info-circle"></i> No actual spoke length entered yet</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="border rounded p-3" style="border-left: 4px solid var(--success-color) !important;">
                        <h6 class="text-success mb-3"><i class="bi bi-arrow-right"></i> Right Side</h6>
                        <div class="mb-2">
                            <span class="text-muted">Calculated Length:</span>
                            <span class="float-end fw-bold fs-5 text-primary">{{ calculated_right }}mm</span>
                        </div>
                        {% if build.actual_spoke_length_right %}
                        <div class="mb-2">
                            <span class="text-muted">Actual Length Used:</span>
                            <span class="float-end fw-bold text-success">{{ build.actual_spoke_length_right }}mm</span>
                        </div>
                        {% else %}
                        <div class="alert alert-info alert-sm mb-0 mt-2">
                            <small><i class="bi bi-info-circle"></i> No actual spoke length entered yet</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="alert alert-info mt-3">
                <i class="bi bi-lightbulb"></i> <strong>Tip:</strong> These are calculated recommendations. Always verify with your spoke manufacturer's sizing chart and consider ordering spokes in 0.5mm increments.
            </div>
            {% else %}
            <div class="alert alert-warning">
                <h6><i class="bi bi-exclamation-triangle"></i> Cannot Calculate Spoke Length</h6>
                <p class="mb-2">The following information is needed to calculate spoke length:</p>
                <ul class="mb-0">
                    {% for missing in missing_data %}
                    <li>{{ missing|title }}</li>
                    {% endfor %}
                </ul>
                <p class="mt-3 mb-0"><strong>Please edit this build to add the missing components.</strong></p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Tension Sessions Section (Placeholder) -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
            <h5 class="mb-0"><i class="bi bi-activity"></i> Tension Sessions</h5>
        </div>
        <div class="card-body">
            <div class="alert alert-info mb-0">
                <i class="bi bi-info-circle"></i> Tension tracking feature coming soon. You'll be able to record and track spoke tension across multiple sessions.
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex gap-2 flex-wrap">
        <a href="/build/{{ build.id }}/edit" class="btn btn-primary">
            <i class="bi bi-pencil"></i> Edit Build
        </a>
        <form method="POST" action="/build/{{ build.id }}/delete" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this build? This action cannot be undone.');">
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Delete Build
            </button>
        </form>
        <a href="/" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<style>
.alert-sm {
    padding: 0.5rem;
    font-size: 0.875rem;
}
</style>
{% endblock %}